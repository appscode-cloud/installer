{{ $helmrepos := dict
  "bootstrap" (index .Values.helm "repositories" "appscode-charts-oci")
  "stakater" (index .Values.helm "repositories" "stakater")
}}

{{ range $name, $cfg := $helmrepos }}
apiVersion: source.toolkit.fluxcd.io/v1beta2
kind: HelmRepository
metadata:
  name: {{ $name }}
  namespace: {{ $.Release.Namespace }}
spec:
  {{- with $cfg.url }}
  url: {{ . }}
  {{- end }}
  interval: {{ default "30m" $cfg.interval }}
  timeout: {{ default "1m" $cfg.timeout }}

  {{- if hasPrefix "oci://" $cfg.url }}
  type: oci
  {{- end }}

  {{- with $cfg.provider }}
  provider: {{ . }}
  {{- end }}

  {{- with $cfg.secretName }}
  secretRef:
    name: {{ include "ace-installer.fullname" $ }}-{{ . }}
  {{- end }}
---
{{- end }}
