{{ $vals := dict "offlineInstaller" $.Values.offlineInstaller "image" $.Values.image "registry" $.Values.registry "helm" dict }}

{{ $helmrepos := dig "repositories" dict $.Values.helm | deepCopy }}
{{ $_ := set $vals.helm "repositories" $helmrepos }}

{{ $helmreleases := printf `
ace:
  version: %q
ace-installer:
  version: %q
flux2:
  version: %q
license-proxyserver:
  version: %q
opscenter-features:
  version: %q
`
  (dig "ace" "version" .Chart.AppVersion $.Values.helm.releases)
  .Chart.AppVersion
  (dig "flux2" "version" "" $.Values.helm.releases)
  (dig "license-proxyserver" "version" .Chart.AppVersion $.Values.helm.releases)
  (dig "opscenter-features" "version" .Chart.AppVersion $.Values.helm.releases)
  | fromYaml }}
{{ $_ := set $vals.helm "releases" $helmreleases }}

apiVersion: charts.x-helm.dev/v1alpha1
kind: ClusterChartPreset
metadata:
  name: bootstrap-presets
  labels:
    ace.appscode.com/managed: "true"
spec:
  values:
    {{- toYaml $vals | nindent 4 }}
