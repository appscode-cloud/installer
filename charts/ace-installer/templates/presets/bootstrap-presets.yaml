{{ $vals := dict "offlineInstaller" $.Values.offlineInstaller "image" $.Values.image "registry" $.Values.registry "helm" dict }}

{{ $helmrepos := dig "repositories" dict $.Values.helm | deepCopy }}
{{ $_ := set $vals.helm "repositories" $helmrepos }}

{{ $helmreleases := printf `
ace:
  version: %q
ace-installer:
  version: %q
ace-ocm-addons:
  version: %q
flux2:
  version: %q
kube-ui-server:
  version: %q
license-proxyserver:
  version: %q
opscenter-features:
  version: %q
  values:
    helm:
      releases:
        service-presets:
          values: %s
        stash-presets:
          values: %s
`
  (dig "ace" "version" .Chart.AppVersion $.Values.helm.releases)
  .Chart.Version
  (dig "ace-ocm-addons" "version" .Chart.AppVersion $.Values.helm.releases)
  (dig "flux2" "version" "" $.Values.helm.releases)
  (dig "kube-ui-server" "version" "" $.Values.helm.releases)
  (dig "license-proxyserver" "version" .Chart.AppVersion $.Values.helm.releases)
  (dig "opscenter-features" "version" .Chart.AppVersion $.Values.helm.releases)
  ((dig "opscenter-features" "values" "helm" "releases" "service-presets" "values" (dict) $.Values.helm.releases) | toJson)
  ((dig "opscenter-features" "values" "helm" "releases" "stash-presets" "values" (dict) $.Values.helm.releases) | toJson)
  | fromYaml }}
{{ $_ := set $vals.helm "releases" $helmreleases }}

apiVersion: charts.x-helm.dev/v1alpha1
kind: ClusterChartPreset
metadata:
  name: bootstrap-presets
  labels:
    ace.appscode.com/managed: "true"
spec:
  values:
    {{- toYaml $vals | nindent 4 }}
