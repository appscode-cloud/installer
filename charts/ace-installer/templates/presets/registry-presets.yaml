{{ $vals := dict "image" $.Values.image "registry" $.Values.registry "helm" dict }}

{{ $helmrepos := dig "repositories" dict $.Values.helm | deepCopy }}
{{ $_ := unset $helmrepos "stakater" }}
{{ $_ := set $vals.helm "repositories" $helmrepos }}

{{ $helmreleases := printf `
opscenter-features:
  version: %q
`
  (dig "opscenter-features" "version" .Chart.AppVersion $.Values.helm.releases)
  | fromYaml }}
{{ $_ := set $vals.helm "releases" $helmreleases }}

apiVersion: charts.x-helm.dev/v1alpha1
kind: ClusterChartPreset
metadata:
  name: registry-presets
  labels:
    ace.appscode.com/managed: "true"
spec:
  values:
    {{- toYaml $vals | nindent 4 }}
